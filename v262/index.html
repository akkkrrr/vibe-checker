<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Vibe Checker âœ¨</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    
    <!-- PWA Meta Tags (Disabled for v2.6 - Compatibility) -->
    <!-- <link rel="manifest" href="/manifest.json"> -->
    <meta name="theme-color" content="#d4af37">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Vibe Checker">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <meta name="description" content="Intiimi kommunikaatio ilman painostusta">
</head>
<body>
    <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
        ğŸŒ™
    </button>

    <!-- WELCOME SCREEN -->
    <div id="welcome-screen" class="screen active">
        <div class="container">
            <nav class="nav-bar">
                <button class="nav-btn active" data-nav="welcome">Etusivu</button>
                <button class="nav-btn" data-nav="history">Historia</button>
            </nav>

            <div class="logo-container">
                <h1 class="logo">Vibe Checker</h1>
                <p class="tagline">Uskalla jakaa. Uskalla vastata.</p>
            </div>
            
            <div class="action-buttons" id="welcome-actions">
                <button class="btn btn-primary" id="create-session-btn">
                    <span class="btn-icon">âœ¨</span>
                    Luo kutsu
                </button>
                <button class="btn btn-secondary" id="join-session-btn">
                    <span class="btn-icon">ğŸ’Œ</span>
                    Avaa kutsu
                </button>
            </div>
            
            <!-- UUSI: Active Session Box -->
            <div id="active-session-box" class="active-session-box" style="display: none;">
                <div class="active-session-card">
                    <h3>ğŸ“Œ Aktiivinen sessio: <span id="active-session-id"></span></h3>
                    <p class="session-status" id="active-session-status"></p>
                    
                    <div class="session-actions">
                        <button class="btn btn-primary" id="check-updates-home-btn">
                            ğŸ”„ Tarkista pÃ¤ivitykset
                        </button>
                        <button class="btn btn-secondary" id="continue-session-btn">
                            ğŸ“ Jatka
                        </button>
                        <button class="btn btn-outline" id="cancel-session-home-btn">
                            âœ• Peruuta sessio
                        </button>
                    </div>
                </div>
            </div>

            <div class="info-card">
                <p class="info-text">Kumppanisi nÃ¤kee toiveesi ja voi rakentaa niille. LÃ¶ydÃ¤tte yhteisen hetken turvallisesti ja ilman painostusta. â¤ï¸</p>
            </div>
        </div>
    </div>

    <!-- SELECTION SCREEN -->
    <div id="selection-screen" class="screen">
        <div class="container">
            <div class="header-section">
                <h2 class="screen-title">Valitse vibesi</h2>
                <p class="session-info">Sessio: <span id="session-id-display"></span></p>
                <div class="session-actions">
                    <button class="btn btn-icon-only" id="help-btn" title="Ohjeet">â“</button>
                    <button class="btn btn-primary btn-small" id="check-updates-btn" style="display: none;" title="Tarkista kumppanin vastaus">
                        <span class="btn-icon">ğŸ”„</span>
                        Tarkista pÃ¤ivitykset
                    </button>
                    <button class="btn btn-secondary btn-small" id="copy-link-btn">
                        <span class="btn-icon">ğŸ”—</span>
                        Kopioi linkki
                    </button>
                    <button class="btn btn-outline btn-small" id="cancel-session-btn">
                        <span class="btn-icon">âœ•</span>
                        Peruuta
                    </button>
                </div>
            </div>

            <!-- Sticky Action Bar (Partner B vastaus) -->
            <div id="sticky-action-bar" class="sticky-action-bar" style="display: none;">
                <div class="sticky-action-content">
                    <div class="sticky-info">
                        <span class="sticky-icon">ğŸ’¡</span>
                        <span class="sticky-text">Kumppanin ehdotus</span>
                    </div>
                    <div class="sticky-actions">
                        <button class="btn btn-primary btn-small" id="sticky-accept-btn">
                            âœ… HyvÃ¤ksy
                        </button>
                        <button class="btn btn-secondary btn-small" id="sticky-modify-btn">
                            âœï¸ Muokkaa
                        </button>
                    </div>
                </div>
            </div>

            <section class="selection-section" id="negotiation-form">
                <h3 class="section-title">Tunnelma <span class="required-badge">pakollinen</span></h3>
                <div class="mood-grid mood-grid-5">
                    <button class="mood-card" data-mood="sensuelli">
                        <span class="mood-icon">ğŸŒ¹</span>
                        <span class="mood-label">Sensuelli</span>
                    </button>
                    <button class="mood-card" data-mood="villi">
                        <span class="mood-icon">ğŸ”¥</span>
                        <span class="mood-label">Villi</span>
                    </button>
                    <button class="mood-card" data-mood="leikkisa">
                        <span class="mood-icon">ğŸ˜ˆ</span>
                        <span class="mood-label">LeikkisÃ¤</span>
                    </button>
                    <button class="mood-card" data-mood="dominoiva">
                        <span class="mood-icon">ğŸ‘‘</span>
                        <span class="mood-label">Dominoiva</span>
                    </button>
                    <button class="mood-card" data-mood="hella">
                        <span class="mood-icon">ğŸ’•</span>
                        <span class="mood-label">HellÃ¤</span>
                    </button>
                </div>
            </section>

            <section class="selection-section">
                <h3 class="section-title">Fokus <span class="required-badge">pakollinen</span></h3>
                <div class="mood-grid mood-grid-4">
                    <button class="mood-card" data-focus="minun-nautinto">
                        <span class="mood-icon">âœ¨</span>
                        <span class="mood-label">Minun nautintoni</span>
                    </button>
                    <button class="mood-card" data-focus="kumppanin-nautinto">
                        <span class="mood-icon">ğŸ’</span>
                        <span class="mood-label">Kumppanin nautinto</span>
                    </button>
                    <button class="mood-card" data-focus="matka-tarkein">
                        <span class="mood-icon">ğŸ­</span>
                        <span class="mood-label">Matka > MÃ¤Ã¤rÃ¤npÃ¤Ã¤</span>
                    </button>
                    <button class="mood-card" data-focus="molemmat">
                        <span class="mood-icon">ğŸ”¥</span>
                        <span class="mood-label">Molemmat yhtÃ¤ aikaa</span>
                    </button>
                </div>
            </section>

            <section class="selection-section">
                <h3 class="section-title">Tempo</h3>
                <div class="mood-grid mood-grid-3">
                    <button class="mood-card" data-tempo="rento">
                        <span class="mood-icon">ğŸŒŠ</span>
                        <span class="mood-label">Rento</span>
                    </button>
                    <button class="mood-card" data-tempo="keskitahti">
                        <span class="mood-icon">ğŸ’«</span>
                        <span class="mood-label">Keskitahti</span>
                    </button>
                    <button class="mood-card" data-tempo="energinen">
                        <span class="mood-icon">âš¡</span>
                        <span class="mood-label">Energinen</span>
                    </button>
                </div>
            </section>

            <section class="selection-section">
                <h3 class="section-title">Intensiteetti</h3>
                <div class="mood-grid mood-grid-3">
                    <button class="mood-card" data-intensity="lempeÃ¤">
                        <span class="mood-icon">ğŸ•Šï¸</span>
                        <span class="mood-label">LempeÃ¤</span>
                    </button>
                    <button class="mood-card" data-intensity="kohtalainen">
                        <span class="mood-icon">ğŸŒŸ</span>
                        <span class="mood-label">Kohtalainen</span>
                    </button>
                    <button class="mood-card" data-intensity="intensiivinen">
                        <span class="mood-icon">ğŸ’¥</span>
                        <span class="mood-label">Intensiivinen</span>
                    </button>
                </div>
            </section>

            <section class="selection-section">
                <h3 class="section-title">Kontrolli</h3>
                <div class="mood-grid mood-grid-3">
                    <button class="mood-card" data-control="valitsen-kumppanille">
                        <span class="mood-icon">ğŸ¯</span>
                        <span class="mood-label">Valitsen kumppanille</span>
                    </button>
                    <button class="mood-card" data-control="kumppani-valitsee">
                        <span class="mood-icon">ğŸ</span>
                        <span class="mood-label">Kumppani valitsee</span>
                    </button>
                    <button class="mood-card" data-control="yhdessa-paatamme">
                        <span class="mood-icon">ğŸ¤</span>
                        <span class="mood-label">YhdessÃ¤ pÃ¤Ã¤tÃ¤mme</span>
                    </button>
                </div>
            </section>

            <section class="selection-section">
                <h3 class="section-title">Rooli</h3>
                <div class="mood-grid mood-grid-3">
                    <button class="mood-card" data-role="aktiivinen">
                        <span class="mood-icon">ğŸš€</span>
                        <span class="mood-label">Aktiivinen</span>
                    </button>
                    <button class="mood-card" data-role="passiivinen">
                        <span class="mood-icon">ğŸ˜Œ</span>
                        <span class="mood-label">Passiivinen</span>
                    </button>
                    <button class="mood-card" data-role="vuorotellen">
                        <span class="mood-icon">ğŸ”„</span>
                        <span class="mood-label">Vuorotellen</span>
                    </button>
                </div>
            </section>

            <section class="selection-section">
                <h3 class="section-title">Ajankohta <span class="required-badge">pakollinen</span></h3>
                <div class="time-quick-select">
                    <button class="time-btn" data-time="now" data-time-display="Kohta">
                        <span class="time-icon">âš¡</span>
                        <span class="time-label">Kohta</span>
                    </button>
                    <button class="time-btn" data-time="30min" data-time-display="30 min">
                        <span class="time-icon">â°</span>
                        <span class="time-label">30 min</span>
                    </button>
                    <button class="time-btn" data-time="1h" data-time-display="1 tunti">
                        <span class="time-icon">âŒ›</span>
                        <span class="time-label">1 tunti</span>
                    </button>
                    <button class="time-btn" data-time="evening" data-time-display="Illalla">
                        <span class="time-icon">ğŸŒ™</span>
                        <span class="time-label">Illalla</span>
                    </button>
                </div>
                
                <!-- TAI-erottaja -->
                <div class="time-separator">
                    <span class="separator-line"></span>
                    <span class="separator-text">tai valitse tarkka aika</span>
                    <span class="separator-line"></span>
                </div>
                
                <!-- Kellonaika-slider -->
                <div class="time-slider-container">
                    <div class="time-display-value">
                        <span id="time-val">20:00</span>
                    </div>
                    <input type="range" 
                           id="time-slider" 
                           class="time-slider" 
                           min="0" 
                           max="1440" 
                           step="15" 
                           value="1200"
                           data-time="custom"
                           aria-label="Valitse tarkka kellonaika">
                    <div class="time-slider-labels">
                        <span>00:00</span>
                        <span>06:00</span>
                        <span>12:00</span>
                        <span>18:00</span>
                        <span>23:59</span>
                    </div>
                </div>
            </section>

            <section class="selection-section">
                <h3 class="section-title">Kommunikaatio</h3>
                <div class="spice-grid">
                    <label class="spice-card">
                        <input type="checkbox" name="communication" value="dirty-talk">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ’¬</span>
                            <span class="spice-label">Dirty talk</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="communication" value="kuiskailu">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ¤«</span>
                            <span class="spice-label">Kuiskailu</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="communication" value="hiljaisuus">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ¤</span>
                            <span class="spice-label">Hiljaisuus</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="communication" value="ohjeiden-anto">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ“¢</span>
                            <span class="spice-label">Ohjeiden anto</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="communication" value="kehut">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸŒŸ</span>
                            <span class="spice-label">Kehut</span>
                        </div>
                    </label>
                </div>
            </section>

            <section class="selection-section">
                <h3 class="section-title">Asut</h3>
                <div class="spice-grid">
                    <label class="spice-card">
                        <input type="checkbox" name="outfits" value="pitsialusvaatteet">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ‘™</span>
                            <span class="spice-label">Pitsialusvaatteet</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="outfits" value="body-korset">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ‘—</span>
                            <span class="spice-label">Body/Korset</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="outfits" value="aamutakki">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ§¥</span>
                            <span class="spice-label">Aamutakki</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="outfits" value="alaston">
                        <div class="spice-content">
                            <span class="spice-icon">âœ¨</span>
                            <span class="spice-label">Alaston</span>
                        </div>
                    </label>
                </div>
            </section>

            <section class="selection-section">
                <h3 class="section-title">Nylon & Sukat</h3>
                <div class="spice-grid">
                    <label class="spice-card">
                        <input type="checkbox" name="nylon" value="nude-stay-ups">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ¦µ</span>
                            <span class="spice-label">Nude stay-ups</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="nylon" value="black-stay-ups">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ–¤</span>
                            <span class="spice-label">Black stay-ups</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="nylon" value="white-stay-ups">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ¤</span>
                            <span class="spice-label">White stay-ups</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="nylon" value="red-stay-ups">
                        <div class="spice-content">
                            <span class="spice-icon">â¤ï¸</span>
                            <span class="spice-label">Red stay-ups</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="nylon" value="avoimet-sukkahousut">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ•³ï¸</span>
                            <span class="spice-label">Avoimet sukkahousut</span>
                        </div>
                    </label>
                </div>
            </section>

            <section class="selection-section">
                <h3 class="section-title">Aistit & Sidonta</h3>
                <div class="spice-grid">
                    <label class="spice-card">
                        <input type="checkbox" name="sensory" value="blindfold">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ˜</span>
                            <span class="spice-label">Blindfold</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="sensory" value="kuulokkeet">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ§</span>
                            <span class="spice-label">Kuulokkeet</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="sensory" value="valokuvaus">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ“¸</span>
                            <span class="spice-label">Valokuvaus</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="sensory" value="bondage">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸª¢</span>
                            <span class="spice-label">Bondage</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="sensory" value="kahleet">
                        <div class="spice-content">
                            <span class="spice-icon">â›“ï¸</span>
                            <span class="spice-label">Kahleet</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="sensory" value="jaa">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ§Š</span>
                            <span class="spice-label">JÃ¤Ã¤</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="sensory" value="kuuma-vaha">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ•¯ï¸</span>
                            <span class="spice-label">Kuuma vaha</span>
                        </div>
                    </label>
                </div>
            </section>

            <section class="selection-section">
                <h3 class="section-title">BDSM / Valta</h3>
                <div class="spice-grid">
                    <label class="spice-card">
                        <input type="checkbox" name="bdsm" value="piiskaus">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ”±</span>
                            <span class="spice-label">Piiskaus</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="bdsm" value="paddle">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ“</span>
                            <span class="spice-label">Paddle</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="bdsm" value="raippa">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ¯</span>
                            <span class="spice-label">Raippa</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="bdsm" value="spanking">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ‘‹</span>
                            <span class="spice-label">Spanking</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="bdsm" value="kuristaminen">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ«±</span>
                            <span class="spice-label">Kuristaminen</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="bdsm" value="pureminen">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ¦·</span>
                            <span class="spice-label">Pureminen</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="bdsm" value="kynnet">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ’…</span>
                            <span class="spice-label">Kynnet</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="bdsm" value="nannipuristus">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ”˜</span>
                            <span class="spice-label">NÃ¤nnipuristus</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="bdsm" value="hiusten-vetaminen">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ’‡</span>
                            <span class="spice-label">Hiusten vetÃ¤minen</span>
                        </div>
                    </label>
                </div>
            </section>

            <section class="selection-section">
                <h3 class="section-title">Lelut & VÃ¤lineet</h3>
                <div class="spice-grid">
                    <label class="spice-card">
                        <input type="checkbox" name="toys" value="vibrator">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ“³</span>
                            <span class="spice-label">Vibraattori</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="toys" value="dildo">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ†</span>
                            <span class="spice-label">Dildo</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="toys" value="strap-on">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ¦¾</span>
                            <span class="spice-label">Strap-on</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="toys" value="nannipiistimet">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ“</span>
                            <span class="spice-label">NÃ¤nnipiistimet</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="toys" value="anaalitappi">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ”Œ</span>
                            <span class="spice-label">Anaalitappi</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="toys" value="hierontaoljy">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ’§</span>
                            <span class="spice-label">HierontaÃ¶ljy</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="toys" value="sormipeli">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ‘†</span>
                            <span class="spice-label">Sormipeli</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="toys" value="feather-tickler">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸª¶</span>
                            <span class="spice-label">Feather tickler</span>
                        </div>
                    </label>
                </div>
            </section>

            <section class="selection-section">
                <h3 class="section-title">Erityisfokukset</h3>
                <div class="spice-grid">
                    <label class="spice-card">
                        <input type="checkbox" name="special" value="toisen-orgasmi-edella">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ</span>
                            <span class="spice-label">Toisen orgasmi edellÃ¤</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="special" value="vain-nautintoa-toiselle">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ’</span>
                            <span class="spice-label">Vain nautintoa toiselle</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="special" value="useat-orgasmit">
                        <div class="spice-content">
                            <span class="spice-icon">â™¾ï¸</span>
                            <span class="spice-label">Useat orgasmit</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="special" value="edging">
                        <div class="spice-content">
                            <span class="spice-icon">â³</span>
                            <span class="spice-label">Edging</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="special" value="yhdynta-kielletty">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸš«</span>
                            <span class="spice-label">YhdyntÃ¤ kielletty</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="special" value="foreplay-fokus">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ’«</span>
                            <span class="spice-label">Foreplay-fokus</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="special" value="quickie">
                        <div class="spice-content">
                            <span class="spice-icon">âš¡</span>
                            <span class="spice-label">Quickie</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="special" value="tantric">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ•‰ï¸</span>
                            <span class="spice-label">Tantric</span>
                        </div>
                    </label>
                </div>
            </section>

            <section class="selection-section">
                <h3 class="section-title">Turvallisuus & Huolenpito</h3>
                <div class="spice-grid">
                    <label class="spice-card">
                        <input type="checkbox" name="safety" value="aftercare">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ«‚</span>
                            <span class="spice-label">Aftercare</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="safety" value="safe-word">
                        <div class="spice-content">
                            <span class="spice-icon">ğŸ›‘</span>
                            <span class="spice-label">Safe word</span>
                        </div>
                    </label>
                    <label class="spice-card">
                        <input type="checkbox" name="safety" value="checkpoints">
                        <div class="spice-content">
                            <span class="spice-icon">âœ…</span>
                            <span class="spice-label">Checkpoints</span>
                        </div>
                    </label>
                </div>
            </section>

            <div class="submit-section">
                <button class="btn btn-primary btn-large" id="submit-selection-btn">
                    ğŸ’Œ LÃ¤hetÃ¤ valintani
                </button>
            </div>
        </div>
    </div>

    <!-- RESULTS SCREEN -->
    <div id="results-screen" class="screen">
        <div class="container">
            <div id="waiting-state" class="waiting-container">
                <div class="waiting-animation">
                    <span class="pulse-icon">ğŸ’­</span>
                </div>
                <h3 class="waiting-title">Odottaa kumppania...</h3>
                <p class="waiting-text">Kumppanisi ei ole vielÃ¤ lÃ¤hettÃ¤nyt valintojaan.</p>
                
                <!-- UUSI: Polling Status -->
                <div id="polling-status" class="polling-status" style="display: none;">
                    <span id="polling-text">ğŸ”„ Tarkistetaan automaattisesti...</span>
                    <span id="polling-countdown" class="polling-countdown"></span>
                </div>
                
                <div class="waiting-actions">
                    <button class="btn btn-primary" id="manual-check-btn">
                        ğŸ”„ Tarkista nyt
                    </button>
                    <button class="btn btn-secondary" id="return-home-btn">
                        ğŸ  Palaa etusivulle
                    </button>
                    <button class="btn btn-secondary" id="back-to-edit-btn">
                        âœï¸ Muokkaa ehdotusta
                    </button>
                    <button class="btn btn-outline" id="cancel-proposal-btn">
                        âœ• Peruuta ehdotus
                    </button>
                </div>
            </div>

            <div id="match-results" class="results-container" style="display: none;">
                <!-- Dynaaminen sisÃ¤ltÃ¶ tÃ¤ytetÃ¤Ã¤n JS:llÃ¤ -->
            </div>
        </div>

        <!-- Mobile Quick Actions (Sticky Footer) -->
        <div id="mobile-quick-actions" class="mobile-quick-actions" style="display: none;">
            <button class="btn btn-primary" id="mobile-accept-btn">
                âœ… HyvÃ¤ksy
            </button>
            <button class="btn btn-secondary" id="mobile-modify-btn">
                âœï¸ Muokkaa
            </button>
        </div>
    </div>

    <!-- HISTORY SCREEN -->
    <div id="history-screen" class="screen">
        <div class="container">
            <div class="header-section">
                <h2 class="screen-title">Historia</h2>
                <p class="tagline">Toteutuneet sessiot</p>
            </div>

            <nav class="nav-bar">
                <button class="nav-btn" data-nav="welcome">Etusivu</button>
                <button class="nav-btn active" data-nav="history">Historia</button>
            </nav>

            <div id="history-list" class="history-grid">
                <div class="empty-history">
                    <div class="empty-history-icon">ğŸ“š</div>
                    <p>Ei vielÃ¤ toteutuneita sessioita</p>
                    <p class="info-text-small">HyvÃ¤ksytyt sessiot nÃ¤kyvÃ¤t tÃ¤Ã¤llÃ¤</p>
                </div>
            </div>
        </div>
    </div>

    <!-- HELP MODAL -->
    <div id="help-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" id="modal-close">âœ•</button>
            <h2 class="modal-title">ğŸ“– KÃ¤yttÃ¶ohje</h2>
            <div class="modal-body">
                <section class="help-section">
                    <h3>ğŸ¯ NÃ¤in se toimii:</h3>
                    <ol>
                        <li><strong>Partner A</strong> luo kutsun ja tÃ¤yttÃ¤Ã¤ toiveensa</li>
                        <li>Linkki kopioidaan automaattisesti â€“ jaa se kumppanillesi</li>
                        <li><strong>Partner B</strong> avaa linkin ja nÃ¤kee Partner A:n valinnat (kultaiset kortit ğŸ‘¤)</li>
                        <li>Partner B voi hyvÃ¤ksyÃ¤, lisÃ¤tÃ¤ omia tai muokata</li>
                        <li>Kun molemmat ovat lÃ¤hettÃ¤neet, nÃ¤ette yhteisen tuloksen!</li>
                    </ol>
                </section>
                
                <section class="help-section">
                    <h3>âš“ Kultaiset kortit (Golden Anchors):</h3>
                    <p>Kun Partner B avaa linkin, <strong>kultaisella reunuksella</strong> merkityt kortit ovat Partner A:n valintoja.</p>
                    <ul>
                        <li>âœ… <strong>Samaa mieltÃ¤?</strong> JÃ¤tÃ¤ se valituksi</li>
                        <li>â• <strong>Haluat lisÃ¤tÃ¤ oman?</strong> Klikkaa lisÃ¤Ã¤ kortteja</li>
                        <li>âŒ <strong>Eri mieltÃ¤?</strong> Klikkaa korttia poistaaksesi</li>
                    </ul>
                </section>
                
                <section class="help-section">
                    <h3>ğŸ”„ Automaattinen tarkistus:</h3>
                    <p>Kun lÃ¤hetÃ¤t ehdotuksesi, sovellus <strong>tarkistaa automaattisesti</strong> kumppanin vastauksen:</p>
                    <ul>
                        <li><strong>0-30s:</strong> Tarkistaa joka 5 sekunti</li>
                        <li><strong>30s-2min:</strong> Joka 10 sekunti</li>
                        <li><strong>2-10min:</strong> Joka 30 sekunti</li>
                        <li><strong>10-30min:</strong> Joka 2 minuuttia</li>
                        <li><strong>30min-2h:</strong> Joka 5 minuuttia</li>
                    </ul>
                    <p>Voit myÃ¶s klikata <strong>"Tarkista nyt"</strong> -nappia milloin vain!</p>
                </section>
                
                <section class="help-section">
                    <h3>ğŸ  Palaa etusivulle:</h3>
                    <p>Voit palata etusivulle milloin vain â€“ <strong>sessiosi sÃ¤ilyy</strong>. Etusivulla nÃ¤et aktiivisen session ja voit:</p>
                    <ul>
                        <li>ğŸ”„ Tarkistaa pÃ¤ivitykset</li>
                        <li>ğŸ“ Jatkaa lomakkeen muokkausta</li>
                        <li>âœ• Peruuttaa session</li>
                    </ul>
                </section>

                <section class="help-section">
                    <h3>ğŸ”’ Tietoturva:</h3>
                    <p>Kaikki tiedot tallennetaan turvallisesti Firebase-pilveen. Vain sinÃ¤ ja kumppanisi nÃ¤ette omat valintanne.</p>
                </section>
                
                <section class="help-section">
                    <h3>ğŸ’¡ VinkkejÃ¤:</h3>
                    <ul>
                        <li>Ole rehellinen â€“ kumppanisi nÃ¤kee ehdotuksesi!</li>
                        <li>HyvÃ¤ksy kumppanin valintoja rohkeasti</li>
                        <li>Voit muokata ehdotusta useaan kertaan (max 3 kierrosta)</li>
                        <li>Kaikki on vapaaehtoista â€“ ei painostusta! â¤ï¸</li>
                    </ul>
                </section>
            </div>
        </div>
    </div>

    <!-- Professional Footer -->
    <footer class="app-footer">
        <div class="footer-content">
            <span class="footer-copyright">Copyright Â© 2026 Vibe Checker | v2.6.1-polling</span>
            <div class="footer-status">
                <span class="status-dot status-online"></span>
                <span class="status-text">Systems Operational</span>
            </div>
            <button class="btn btn-outline btn-tiny emergency-reset-btn" id="emergency-reset-btn" title="TyhjennÃ¤ kaikki data">
                ğŸš¨ Reset
            </button>
        </div>
    </footer>

    <!-- Global Help Button (Fixed) -->
    <button class="global-help-btn" id="global-help-btn" title="Ohjeet">
        â“
    </button>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="app.js"></script>
</body>
</html>
